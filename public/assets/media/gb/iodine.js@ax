function GlueCodeMixer(e){var t=this;this.audio=new XAudioServer(2,this.sampleRate,0,this.bufferAmount,null,(function(){t.checkHeartbeats()}),(function(){t.checkPostHeartbeats()}),1,(function(){t.disableAudio()}),e),this.outputUnits=[],this.outputUnitsValid=[],this.initializeBuffer()}function GlueCodeMixerInput(e){this.mixer=e,this.volume=1}function AudioBufferWrapper(e,t,i,o,n){this.channelCount=e,this.mixerChannelCount=t,this.bufferAmount=i,this.sampleRate=o,this.mixerSampleRate=n,this.initialize()}function AudioSimpleBuffer(e,t){this.channelCount=e,this.bufferAmount=t,this.outBufferSize=this.channelCount*this.bufferAmount,this.stackLength=0,this.buffer=getFloat32Array(this.outBufferSize)}GlueCodeMixer.prototype.sampleRate=44100,GlueCodeMixer.prototype.bufferAmount=44100,GlueCodeMixer.prototype.channelCount=2,GlueCodeMixer.prototype.initializeBuffer=function(){this.buffer=new AudioSimpleBuffer(this.channelCount,this.bufferAmount)},GlueCodeMixer.prototype.appendInput=function(e){if(this.audio){for(var t=0;t<this.outputUnits.length&&this.outputUnits[t];t++);this.outputUnits[t]=e,this.outputUnitsValid.push(e),e.registerStackPosition(t)}else'function'==typeof e.errorCallback&&e.errorCallback()},GlueCodeMixer.prototype.unregister=function(e){this.outputUnits[e]=null,this.outputUnitsValid=[];for(var t=0,i=this.outputUnits.length;t<i;++t)this.outputUnits[t]&&this.outputUnitsValid.push(this.outputUnits)},GlueCodeMixer.prototype.checkHeartbeats=function(){for(var e=this.outputUnitsValid.length,t=0;t<e;++t)this.outputUnitsValid[t].heartBeatCallback()},GlueCodeMixer.prototype.checkPostHeartbeats=function(){for(var e=this.outputUnitsValid.length,t=0;t<e;++t)this.outputUnitsValid[t].postHeartBeatCallback()},GlueCodeMixer.prototype.checkAudio=function(){if(this.audio){for(var e=this.outputUnitsValid.length,t=0,i=0;t<e;++t)this.outputUnitsValid[t].prepareShift();for(var o=0,n=this.findLowestBufferCount();o<n;++o){for(t=0,i=0;t<e;++t)i+=this.outputUnitsValid[t].shift();this.buffer.push(i)}var a=this.buffer.count();this.audio.writeAudioNoCallback(this.buffer.buffer,a),this.buffer.reset()}},GlueCodeMixer.prototype.findLowestBufferCount=function(){for(var e=0,t=0,i=this.outputUnitsValid.length;t<i;++t){var o=this.outputUnitsValid[t].buffer.resampledSamplesLeft();o>0&&(e=e>0?Math.min(e,o):o)}return Math.min(e,this.channelCount*this.bufferAmount)},GlueCodeMixer.prototype.disableAudio=function(){this.audio=null},GlueCodeMixerInput.prototype.initialize=function(e,t,i,o,n,a){this.channelCount=e,this.sampleRate=t,this.bufferAmount=i,this.heartBeatCallback=o,this.postHeartBeatCallback=n,this.errorCallback=a;var r=this.buffer;this.buffer=new AudioBufferWrapper(this.channelCount,this.mixer.channelCount,this.bufferAmount,this.sampleRate,this.mixer.sampleRate),r&&this.buffer.copyOld(r)},GlueCodeMixerInput.prototype.register=function(){this.mixer.appendInput(this)},GlueCodeMixerInput.prototype.setVolume=function(e){this.volume=Math.min(Math.max(e,0),1)},GlueCodeMixerInput.prototype.prepareShift=function(){this.buffer.resampleRefill()},GlueCodeMixerInput.prototype.shift=function(){return this.buffer.shift()*this.volume},GlueCodeMixerInput.prototype.push=function(e,t,i){this.buffer.push(e,t,i),this.mixer.checkAudio()},GlueCodeMixerInput.prototype.pushDeferred=function(e,t,i){this.buffer.push(e,t,i)},GlueCodeMixerInput.prototype.flush=function(){this.mixer.checkAudio()},GlueCodeMixerInput.prototype.remainingBuffer=function(){return this.buffer.remainingBuffer()+Math.floor(this.mixer.audio.remainingBuffer()*this.sampleRate/this.mixer.sampleRate/this.mixer.channelCount)*this.mixer.channelCount},GlueCodeMixerInput.prototype.registerStackPosition=function(e){this.stackPosition=e},GlueCodeMixerInput.prototype.unregister=function(){this.mixer.unregister(this.stackPosition)},GlueCodeMixerInput.prototype.setBufferSpace=function(e){this.buffer.setBufferSpace(e)},AudioBufferWrapper.prototype.initialize=function(){this.inBufferSize=this.bufferAmount*this.mixerChannelCount,this.inBuffer=getFloat32Array(this.inBufferSize),this.resampler=new Resampler(this.sampleRate,this.mixerSampleRate,this.mixerChannelCount,this.inBuffer),this.outBufferSize=this.resampler.outputBuffer.length,this.outBuffer=getFloat32Array(this.outBufferSize),this.inputOffset=0,this.resampleBufferStart=0,this.resampleBufferEnd=0},AudioBufferWrapper.prototype.copyOld=function(e){for(this.resampleRefill();e.resampleBufferStart!=e.resampleBufferEnd;)this.outBuffer[this.resampleBufferEnd++]=e.outBuffer[e.resampleBufferStart++],this.resampleBufferEnd==this.outBufferSize&&(this.resampleBufferEnd=0),this.resampleBufferStart==this.resampleBufferEnd&&(this.resampleBufferStart+=this.mixerChannelCount,this.resampleBufferStart==this.outBufferSize&&(this.resampleBufferStart=0)),e.resampleBufferStart==e.outBufferSize&&(e.resampleBufferStart=0)},AudioBufferWrapper.prototype.push=function(e,t,i){var o=Math.min(e.length,i);if(this.channelCount<this.mixerChannelCount)for(;t<o&&this.inputOffset<this.inBufferSize;){for(var n=this.channelCount;n<this.mixerChannelCount;++n)this.inBuffer[this.inputOffset++]=e[t];for(n=0;n<this.channelCount&&t<o;++n)this.inBuffer[this.inputOffset++]=e[t++]}else if(this.channelCount==this.mixerChannelCount)for(;t<o&&this.inputOffset<this.inBufferSize;)this.inBuffer[this.inputOffset++]=e[t++];else for(;t<o&&this.inputOffset<this.inBufferSize;){for(n=0;n<this.mixerChannelCount&&t<o;++n)this.inBuffer[this.inputOffset++]=e[t++];t+=this.channelCount-this.mixerChannelCount}},AudioBufferWrapper.prototype.shift=function(){var e=0;return this.resampleBufferStart!=this.resampleBufferEnd&&(e=this.outBuffer[this.resampleBufferStart++],this.resampleBufferStart==this.outBufferSize&&(this.resampleBufferStart=0)),e},AudioBufferWrapper.prototype.resampleRefill=function(){if(this.inputOffset>0){for(var e=this.resampler.resampler(this.inputOffset),t=this.resampler.outputBuffer,i=0;i<e;)this.outBuffer[this.resampleBufferEnd++]=t[i++],this.resampleBufferEnd==this.outBufferSize&&(this.resampleBufferEnd=0),this.resampleBufferStart==this.resampleBufferEnd&&(this.resampleBufferStart+=this.mixerChannelCount,this.resampleBufferStart==this.outBufferSize&&(this.resampleBufferStart=0));this.inputOffset=0}},AudioBufferWrapper.prototype.setBufferSpace=function(e){for(;this.inputOffset<e&&this.inputOffset<this.inBufferSize;)this.inBuffer[this.inputOffset++]=0},AudioBufferWrapper.prototype.remainingBuffer=function(){return Math.floor(this.resampledSamplesLeft()*this.resampler.ratioWeight/this.mixerChannelCount)*this.mixerChannelCount+this.inputOffset},AudioBufferWrapper.prototype.resampledSamplesLeft=function(){return(this.resampleBufferStart<=this.resampleBufferEnd?0:this.outBufferSize)+this.resampleBufferEnd-this.resampleBufferStart},AudioSimpleBuffer.prototype.push=function(e){this.stackLength<this.outBufferSize&&(this.buffer[this.stackLength++]=e)},AudioSimpleBuffer.prototype.count=function(){return this.stackLength},AudioSimpleBuffer.prototype.reset=function(){this.stackLength=0};var toBase64=['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','0','1','2','3','4','5','6','7','8','9','+','/','='],fromBase64='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';function base64(e){try{var t=window.btoa(e)}catch(r){t='';var i=e.length;if(i>0){for(var o=[0,0,0],n=0,a=i%3;e.length%3>0;)e[e.length]=' ';for(;n<i;)o=[255&e.charCodeAt(n++),255&e.charCodeAt(n++),255&e.charCodeAt(n++)],t+=toBase64[o[0]>>2]+toBase64[(3&o[0])<<4|o[1]>>4]+toBase64[(15&o[1])<<2|o[2]>>6]+toBase64[63&o[2]];a>0&&(t[t.length-1]='=',2==a?(t[t.length-2]='=',t[t.length-3]=toBase64[(3&o[0])<<4]):t[t.length-2]=toBase64[(15&o[1])<<2])}}return t}function base64_decode(e){try{var t=window.atob(e)}catch(a){t='';var i=e.length;if(i>3&&i%4==0){for(var o=[0,0,0,0],n=0;n<i;)o=[fromBase64.indexOf(e.charAt(n++)),fromBase64.indexOf(e.charAt(n++)),fromBase64.indexOf(e.charAt(n++)),fromBase64.indexOf(e.charAt(n++))],t+=String.fromCharCode(o[0]<<2|o[1]>>4)+String.fromCharCode((15&o[1])<<4|o[2]>>2)+String.fromCharCode((3&o[2])<<6|o[3]);o[3]>=64&&(t.length-=1,o[2]>=64&&(t.length-=1))}}return t}function arrayToBase64(e){for(var t='',i=e.length,o=0;o<i;++o)'number'==typeof e[o]&&(t+=String.fromCharCode(e[o]));return base64(t)}function base64ToArray(e){for(var t=base64_decode(e),i=[],o=t.length,n=0;n<o;)i.push(255&t.charCodeAt(n++));return i}var IodineGUI={Iodine:null,Blitter:null,coreTimerID:null,GUITimerID:null,toMap:null,toMapIndice:0,suspended:!1,isPlaying:!1,startTime:+(new Date).getTime(),mixerInput:null,currentSpeed:[!1,0],defaults:{timerRate:8,sound:!0,volume:1,skipBoot:!1,toggleSmoothScaling:!0,toggleDynamicSpeed:!1,toggleOffthreadGraphics:!0,toggleOffthreadCPU:-1==navigator.userAgent.indexOf('AppleWebKit')||-1!=navigator.userAgent.indexOf('Windows NT 10.0')&&-1==navigator.userAgent.indexOf('Trident'),keyZonesGBA:[88,90,16,13,39,37,38,40,83,65],keyZonesControl:[55,56,52,51,53,54,80,82]}};function downloadBIOS(){downloadFile('../bios.gba',registerBIOS)}function registerBIOS(){processDownload(this,attachBIOS),downloadROM(location.hash.substr(1))}function downloadROM(e){downloadFile(new URL('../'+e+'.gba',location),registerROM)}function registerROM(){clearTempString(),processDownload(this,attachROM)}function registerIodineHandler(){try{if('function'!=typeof SharedArrayBuffer||'object'!=typeof Atomics)throw null;if(!IodineGUI.defaults.toggleOffthreadCPU&&IodineGUI.defaults.toggleOffthreadGraphics)IodineGUI.Iodine=new IodineGBAWorkerGfxShim;else{if(!IodineGUI.defaults.toggleOffthreadGraphics)throw null;IodineGUI.Iodine=new IodineGBAWorkerShim,addEvent('beforeunload',window,registerBeforeUnloadHandler)}}catch(e){IodineGUI.Iodine=new GameBoyAdvanceEmulator}}function registerBeforeUnloadHandler(e){return IodineGUI.Iodine.pause(),e.preventDefault&&e.preventDefault(),'IodineGBA needs to process your save data, leaving now may result in not saving current data.'}function initTimer(){IodineGUI.Iodine.setIntervalRate(+IodineGUI.defaults.timerRate),IodineGUI.coreTimerID=setInterval((function(){IodineGUI.Iodine.timerCallback(+(new Date).getTime()-+IodineGUI.startTime>>>0)}),0|IodineGUI.defaults.timerRate)}function calculateTiming(){IodineGUI.Iodine.setIntervalRate(+IodineGUI.defaults.timerRate)}function startTimer(){IodineGUI.coreTimerID=setInterval((function(){IodineGUI.Iodine.timerCallback(+(new Date).getTime()-+IodineGUI.startTime>>>0)}),0|IodineGUI.defaults.timerRate)}function updateTimer(e){(0|(e|=0))!=(0|IodineGUI.defaults.timerRate)&&(IodineGUI.defaults.timerRate=0|e,IodineGUI.Iodine.setIntervalRate(+IodineGUI.defaults.timerRate),IodineGUI.isPlaying&&(IodineGUI.coreTimerID&&clearInterval(IodineGUI.coreTimerID),initTimer()))}function registerBlitterHandler(){IodineGUI.Blitter=new GfxGlueCode(240,160),IodineGUI.Blitter.attachCanvas(document.getElementById('emulator_target')),IodineGUI.Iodine.attachGraphicsFrameHandler(IodineGUI.Blitter),IodineGUI.Blitter.attachGfxPostCallback((function(){IodineGUI.currentSpeed[0]&&(document.getElementById('speed').textContent='Speed: '+IodineGUI.currentSpeed[1]+'%')}))}function registerAudioHandler(){var e=new GlueCodeMixer(document.getElementById('play'));IodineGUI.mixerInput=new GlueCodeMixerInput(e),IodineGUI.Iodine.attachAudioHandler(IodineGUI.mixerInput)}function GfxGlueCode(e,t){this.graphicsFound=!1,this.gfxCallback=null,this.doSmoothing=!0,this.offscreenWidth=e,this.offscreenHeight=t,this.offscreenRGBCount=this.offscreenWidth*this.offscreenHeight*3,this.offscreenRGBACount=this.offscreenWidth*this.offscreenHeight*4,this.initializeVSync(),this.initializeBuffers()}function registerGUIEvents(){IodineGUI.Iodine.attachPlayStatusHandler(updatePlayButton),addEvent('keydown',document,keyDown),addEvent('keyup',document,keyUpPreprocess),addEvent('change',document.getElementById('rom_load'),fileLoadROM),addEvent('change',document.getElementById('bios_load'),fileLoadBIOS),addEvent('click',document.getElementById('play'),(function(e){IodineGUI.Iodine.play()})),addEvent('click',document.getElementById('pause'),(function(e){IodineGUI.Iodine.pause()})),addEvent('click',document.getElementById('restart'),(function(e){IodineGUI.Iodine.restart()})),addEvent('click',document.getElementById('sound'),(function(){setValue('sound',!!this.checked),this.checked?IodineGUI.Iodine.enableAudio():IodineGUI.Iodine.disableAudio()})),addEvent('click',document.getElementById('skip_boot'),(function(){setValue('skipBoot',!!this.checked),IodineGUI.Iodine.toggleSkipBootROM(this.checked)})),addEvent('click',document.getElementById('toggleSmoothScaling'),(function(){setValue('toggleSmoothScaling',!!this.checked),IodineGUI.Blitter&&IodineGUI.Blitter.setSmoothScaling(this.checked)})),addEvent('click',document.getElementById('toggleDynamicSpeed'),(function(){setValue('toggleDynamicSpeed',!!this.checked),IodineGUI.Iodine.toggleDynamicSpeed(this.checked)})),addEvent('click',document.getElementById('offthread-gpu'),(function(){setValue('toggleOffthreadGraphics',!!this.checked),IodineGUI.Iodine.toggleOffthreadGraphics(this.checked)})),addEvent('click',document.getElementById('offthread-cpu'),(function(){setValue('toggleOffthreadCPU',!!this.checked)})),addEvent('change',document.getElementById('speedset'),speedChangeFunc),addEvent('input',document.getElementById('speedset'),speedChangeFunc),addEvent('click',document.getElementById('fullscreen'),toggleFullScreen),addEvent('click',document.getElementById('key_a'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesGBA,IodineGUI.toMapIndice=0})),addEvent('mousedown',document.getElementById('touch-a'),(function(){IodineGUI.Iodine.keyDown(0)})),addEvent('mouseup',document.getElementById('touch-a'),(function(){IodineGUI.Iodine.keyUp(0)})),addEvent('click',document.getElementById('key_b'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesGBA,IodineGUI.toMapIndice=1})),addEvent('mousedown',document.getElementById('touch-b'),(function(){IodineGUI.Iodine.keyDown(1)})),addEvent('mouseup',document.getElementById('touch-b'),(function(){IodineGUI.Iodine.keyUp(1)})),addEvent('click',document.getElementById('key_select'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesGBA,IodineGUI.toMapIndice=2})),addEvent('mousedown',document.getElementById('touch-select'),(function(){IodineGUI.Iodine.keyDown(2)})),addEvent('mouseup',document.getElementById('touch-select'),(function(){IodineGUI.Iodine.keyUp(2)})),addEvent('click',document.getElementById('key_start'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesGBA,IodineGUI.toMapIndice=3})),addEvent('mousedown',document.getElementById('touch-start'),(function(){IodineGUI.Iodine.keyDown(3)})),addEvent('mouseup',document.getElementById('touch-start'),(function(){IodineGUI.Iodine.keyUp(3)})),addEvent('click',document.getElementById('key_right'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesGBA,IodineGUI.toMapIndice=4})),addEvent('mousedown',document.getElementById('touch-right'),(function(){IodineGUI.Iodine.keyDown(4)})),addEvent('mouseup',document.getElementById('touch-right'),(function(){IodineGUI.Iodine.keyUp(4)})),addEvent('click',document.getElementById('key_left'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesGBA,IodineGUI.toMapIndice=5})),addEvent('mousedown',document.getElementById('touch-left'),(function(){IodineGUI.Iodine.keyDown(5)})),addEvent('mouseup',document.getElementById('touch-left'),(function(){IodineGUI.Iodine.keyUp(5)})),addEvent('click',document.getElementById('key_up'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesGBA,IodineGUI.toMapIndice=6})),addEvent('mousedown',document.getElementById('touch-up'),(function(){IodineGUI.Iodine.keyDown(6)})),addEvent('mouseup',document.getElementById('touch-up'),(function(){IodineGUI.Iodine.keyUp(6)})),addEvent('click',document.getElementById('key_down'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesGBA,IodineGUI.toMapIndice=7})),addEvent('mousedown',document.getElementById('touch-down'),(function(){IodineGUI.Iodine.keyDown(7)})),addEvent('mouseup',document.getElementById('touch-down'),(function(){IodineGUI.Iodine.keyUp(7)})),addEvent('click',document.getElementById('key_r'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesGBA,IodineGUI.toMapIndice=8})),addEvent('mousedown',document.getElementById('touch-r'),(function(){IodineGUI.Iodine.keyDown(8)})),addEvent('mouseup',document.getElementById('touch-r'),(function(){IodineGUI.Iodine.keyUp(8)})),addEvent('click',document.getElementById('key_l'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesGBA,IodineGUI.toMapIndice=9})),addEvent('mousedown',document.getElementById('touch-l'),(function(){IodineGUI.Iodine.keyDown(9)})),addEvent('mouseup',document.getElementById('touch-l'),(function(){IodineGUI.Iodine.keyUp(9)})),addEvent('click',document.getElementById('key_volumedown'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesControl,IodineGUI.toMapIndice=0})),addEvent('click',document.getElementById('key_volumeup'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesControl,IodineGUI.toMapIndice=1})),addEvent('click',document.getElementById('key_speedup'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesControl,IodineGUI.toMapIndice=2})),addEvent('click',document.getElementById('key_slowdown'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesControl,IodineGUI.toMapIndice=3})),addEvent('click',document.getElementById('key_speedreset'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesControl,IodineGUI.toMapIndice=4})),addEvent('click',document.getElementById('key_fullscreen'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesControl,IodineGUI.toMapIndice=5})),addEvent('click',document.getElementById('key_playpause'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesControl,IodineGUI.toMapIndice=6})),addEvent('click',document.getElementById('key_restart'),(function(){IodineGUI.toMap=IodineGUI.defaults.keyZonesControl,IodineGUI.toMapIndice=7})),addEvent('change',document.getElementById('import'),(function(e){if(void 0!==this.files)try{if(this.files.length>=1){writeRedTemporaryText('Reading the local file "'+this.files[0].name+'" for importing.');try{var t=new FileReader;t.onload=function(){if(2==this.readyState){writeRedTemporaryText('file imported.');try{import_save(this.result)}catch(e){writeRedTemporaryText(e.message+' file: '+e.fileName+' line: '+e.lineNumber)}}else writeRedTemporaryText('importing file, please wait...')},t.readAsBinaryString(this.files[this.files.length-1])}catch(e){var i=this.files[this.files.length-1].getAsBinary();try{import_save(i)}catch(e){writeRedTemporaryText(e.message+' file: '+e.fileName+' line: '+e.lineNumber)}}}else writeRedTemporaryText('Incorrect number of files selected for local loading.')}catch(e){writeRedTemporaryText('Could not load in a locally stored ROM file.')}else writeRedTemporaryText('could not find the handle on the file to open.');e.preventDefault&&e.preventDefault()})),addEvent('click',document.getElementById('export'),refreshStorageListing),addEvent('unload',window,ExportSave),IodineGUI.Iodine.attachSpeedHandler((function(e){(e=e.toFixed(2))!=IodineGUI.currentSpeed[1]&&(IodineGUI.currentSpeed[1]=e,IodineGUI.currentSpeed[0]=!0)})),addEvent('change',document.getElementById('volume'),volChangeFunc),addEvent('input',document.getElementById('volume'),volChangeFunc),addEvent('resize',window,resizeCanvasFunc),addEvent('mouseover',document.getElementById('saves_menu'),rebuildSavesMenu),void 0!==document.hidden?addEvent('visibilitychange',document,visibilityChangeHandle):void 0!==document.mozHidden?addEvent('mozvisibilitychange',document,mozVisibilityChangeHandle):void 0!==document.msHidden?addEvent('msvisibilitychange',document,msVisibilityChangeHandle):void 0!==document.webkitHidden&&addEvent('webkitvisibilitychange',document,webkitVisibilityChangeHandle),resizeCanvasFunc()}function registerDefaultSettings(){null===findValue('sound')?setValue('sound',!!IodineGUI.defaults.sound):IodineGUI.defaults.sound=!!findValue('sound'),null===findValue('volume')?setValue('volume',+IodineGUI.defaults.volume):IodineGUI.defaults.volume=+findValue('volume'),document.getElementById('volume').value=Math.round(100*IodineGUI.defaults.volume),document.getElementById('speedset').value=50,null===findValue('skipBoot')?setValue('skipBoot',!!IodineGUI.defaults.skipBoot):IodineGUI.defaults.skipBoot=!!findValue('skipBoot'),null===findValue('toggleSmoothScaling')?setValue('toggleSmoothScaling',!!IodineGUI.defaults.toggleSmoothScaling):IodineGUI.defaults.toggleSmoothScaling=!!findValue('toggleSmoothScaling'),null===findValue('toggleDynamicSpeed')?setValue('toggleDynamicSpeed',!!IodineGUI.defaults.toggleDynamicSpeed):IodineGUI.defaults.toggleDynamicSpeed=!!findValue('toggleDynamicSpeed'),null===findValue('toggleOffthreadGraphics')?setValue('toggleOffthreadGraphics',!!IodineGUI.defaults.toggleOffthreadGraphics):IodineGUI.defaults.toggleOffthreadGraphics=!!findValue('toggleOffthreadGraphics'),null===findValue('toggleOffthreadCPU')?setValue('toggleOffthreadCPU',!!IodineGUI.defaults.toggleOffthreadCPU):IodineGUI.defaults.toggleOffthreadCPU=!!findValue('toggleOffthreadCPU'),null===findValue('key_a')?setValue('key_a',0|IodineGUI.defaults.keyZonesGBA[0]):IodineGUI.defaults.keyZonesGBA[0]=findValue('key_a'),null===findValue('key_b')?setValue('key_b',0|IodineGUI.defaults.keyZonesGBA[1]):IodineGUI.defaults.keyZonesGBA[1]=findValue('key_b'),null===findValue('key_select')?setValue('key_select',0|IodineGUI.defaults.keyZonesGBA[2]):IodineGUI.defaults.keyZonesGBA[2]=findValue('key_select'),null===findValue('key_start')?setValue('key_start',0|IodineGUI.defaults.keyZonesGBA[3]):IodineGUI.defaults.keyZonesGBA[3]=findValue('key_start'),null===findValue('key_right')?setValue('key_right',0|IodineGUI.defaults.keyZonesGBA[4]):IodineGUI.defaults.keyZonesGBA[4]=findValue('key_right'),null===findValue('key_left')?setValue('key_left',0|IodineGUI.defaults.keyZonesGBA[5]):IodineGUI.defaults.keyZonesGBA[5]=findValue('key_left'),null===findValue('key_up')?setValue('key_up',0|IodineGUI.defaults.keyZonesGBA[6]):IodineGUI.defaults.keyZonesGBA[6]=findValue('key_up'),null===findValue('key_down')?setValue('key_down',0|IodineGUI.defaults.keyZonesGBA[7]):IodineGUI.defaults.keyZonesGBA[7]=findValue('key_down'),null===findValue('key_r')?setValue('key_r',0|IodineGUI.defaults.keyZonesGBA[8]):IodineGUI.defaults.keyZonesGBA[8]=findValue('key_r'),null===findValue('key_l')?setValue('key_l',0|IodineGUI.defaults.keyZonesGBA[9]):IodineGUI.defaults.keyZonesGBA[9]=findValue('key_l'),null===findValue('key_volumedown')?setValue('key_volumedown',0|IodineGUI.defaults.keyZonesControl[0]):IodineGUI.defaults.keyZonesControl[0]=findValue('key_volumedown'),null===findValue('key_volumeup')?setValue('key_volumeup',0|IodineGUI.defaults.keyZonesControl[1]):IodineGUI.defaults.keyZonesControl[1]=findValue('key_volumeup'),null===findValue('key_speedup')?setValue('key_speedup',0|IodineGUI.defaults.keyZonesControl[2]):IodineGUI.defaults.keyZonesControl[2]=findValue('key_speedup'),null===findValue('key_slowdown')?setValue('key_slowdown',0|IodineGUI.defaults.keyZonesControl[3]):IodineGUI.defaults.keyZonesControl[3]=findValue('key_slowdown'),null===findValue('key_speedreset')?setValue('key_speedreset',0|IodineGUI.defaults.keyZonesControl[4]):IodineGUI.defaults.keyZonesControl[4]=findValue('key_speedreset'),null===findValue('key_fullscreen')?setValue('key_fullscreen',0|IodineGUI.defaults.keyZonesControl[5]):IodineGUI.defaults.keyZonesControl[5]=findValue('key_fullscreen'),null===findValue('key_playpause')?setValue('key_playpause',0|IodineGUI.defaults.keyZonesControl[6]):IodineGUI.defaults.keyZonesControl[6]=findValue('key_playpause'),null===findValue('key_restart')?setValue('key_restart',0|IodineGUI.defaults.keyZonesControl[7]):IodineGUI.defaults.keyZonesControl[7]=findValue('key_restart')}function saveKeyBindings(){setValue('key_a',0|IodineGUI.defaults.keyZonesGBA[0]),setValue('key_b',0|IodineGUI.defaults.keyZonesGBA[1]),setValue('key_select',0|IodineGUI.defaults.keyZonesGBA[2]),setValue('key_start',0|IodineGUI.defaults.keyZonesGBA[3]),setValue('key_right',0|IodineGUI.defaults.keyZonesGBA[4]),setValue('key_left',0|IodineGUI.defaults.keyZonesGBA[5]),setValue('key_up',0|IodineGUI.defaults.keyZonesGBA[6]),setValue('key_down',0|IodineGUI.defaults.keyZonesGBA[7]),setValue('key_r',0|IodineGUI.defaults.keyZonesGBA[8]),setValue('key_l',0|IodineGUI.defaults.keyZonesGBA[9]),setValue('key_volumedown',0|IodineGUI.defaults.keyZonesControl[0]),setValue('key_volumeup',0|IodineGUI.defaults.keyZonesControl[1]),setValue('key_speedup',0|IodineGUI.defaults.keyZonesControl[2]),setValue('key_slowdown',0|IodineGUI.defaults.keyZonesControl[3]),setValue('key_speedreset',0|IodineGUI.defaults.keyZonesControl[4]),setValue('key_fullscreen',0|IodineGUI.defaults.keyZonesControl[5]),setValue('key_playpause',0|IodineGUI.defaults.keyZonesControl[6]),setValue('key_restart',0|IodineGUI.defaults.keyZonesControl[7])}function registerGUISettings(){document.getElementById('sound').checked=IodineGUI.defaults.sound,IodineGUI.defaults.sound&&IodineGUI.Iodine.enableAudio();try{var e=document.getElementById('volume');e.min=0,e.max=100,e.step=1,e.value=100*IodineGUI.defaults.volume}catch(e){}IodineGUI.mixerInput.setVolume(IodineGUI.defaults.volume),document.getElementById('skip_boot').checked=IodineGUI.defaults.skipBoot,IodineGUI.Iodine.toggleSkipBootROM(IodineGUI.defaults.skipBoot),document.getElementById('toggleSmoothScaling').checked=IodineGUI.defaults.toggleSmoothScaling,IodineGUI.Blitter.setSmoothScaling(IodineGUI.defaults.toggleSmoothScaling),document.getElementById('toggleDynamicSpeed').checked=IodineGUI.defaults.toggleDynamicSpeed,IodineGUI.Iodine.toggleDynamicSpeed(IodineGUI.defaults.toggleDynamicSpeed),document.getElementById('offthread-gpu').checked=IodineGUI.defaults.toggleOffthreadGraphics,IodineGUI.Iodine.toggleOffthreadGraphics(IodineGUI.defaults.toggleOffthreadGraphics),document.getElementById('offthread-cpu').checked=IodineGUI.defaults.toggleOffthreadCPU,'function'==typeof SharedArrayBuffer&&'object'==typeof Atomics||(document.getElementById('offthread-gpu').disabled=!0,document.getElementById('offthread-cpu').disabled=!0)}function updatePlayButton(e){1==(0|(e|=0))?(document.getElementById('play').className='hide',document.getElementById('pause').className='show',document.getElementById('menu').className='playing',IodineGUI.coreTimerID||startTimer(),IodineGUI.isPlaying=!0):(document.getElementById('pause').className='hide',document.getElementById('play').className='show',document.getElementById('menu').className='paused',IodineGUI.coreTimerID&&(clearInterval(IodineGUI.coreTimerID),IodineGUI.coreTimerID=null),IodineGUI.isPlaying=!1)}function visibilityChangeHandle(){processVisibilityChange(document.hidden)}function mozVisibilityChangeHandle(){processVisibilityChange(document.mozHidden)}function msVisibilityChangeHandle(){processVisibilityChange(document.msHidden)}function webkitVisibilityChangeHandle(){processVisibilityChange(document.webkitHidden)}function processVisibilityChange(e){e?'hide'==document.getElementById('play').className&&(IodineGUI.Iodine.pause(),IodineGUI.suspended=!0):IodineGUI.suspended&&(IodineGUI.suspended=!1,IodineGUI.Iodine.play())}function stepVolume(e){var t=document.getElementById('volume').value/100;t=Math.min(Math.max(t+e,0),1),IodineGUI.mixerInput.setVolume(t),document.getElementById('volume').value=Math.round(100*t)}function volChangeFunc(){var e=.01*Math.min(Math.max(parseInt(this.value),0),100);setValue('volume',+e),IodineGUI.mixerInput.setVolume(+e)}function speedChangeFunc(){var e=Math.min(Math.max(parseInt(this.value),0),100)/50;e*=e,IodineGUI.Iodine.setSpeed(+e)}function writeRedTemporaryText(e){IodineGUI.GUITimerID&&clearTimeout(IodineGUI.GUITimerID),document.getElementById('tempMessage').style.display='block',document.getElementById('tempMessage').textContent=e,IodineGUI.GUITimerID=setTimeout(clearTempString,5e3)}function clearTempString(){document.getElementById('tempMessage').style.display='none'}function resizeCanvasFunc(){var e=document.getElementById('main'),t=e.clientHeight||e.offsetHeight||0,i=e.clientWidth||e.offsetWidth||0;if(t>0&&i>0){var o=document.getElementById('emulator_target'),n=Math.floor(1.5*t),a=Math.floor(i/1.5),r=Math.min(a,t),u=Math.min(n,i);o.style.width=u+'px',o.style.height=r+'px'}}function rebuildSavesMenu(e){didNotEnter(document.getElementById('saves_menu_container'),e)&&(ExportSave(),rebuildExistingSaves(),e.preventDefault&&e.preventDefault())}function rebuildExistingSaves(){var e=document.getElementById('existing_saves_list');ExportSave(),removeChildNodes(e);for(var t=getSavesKeys();t.length>0;)addExistingSaveItem(e,t.shift())}function addExistingSaveItem(e,t){var i=document.createElement('li');i.className='nowrap';var o=document.createElement('span');o.textContent=decodeKeyType(t),i.appendChild(o);var n=document.createElement('ul'),a=document.createElement('li');a.className='nowrap',addEvent('click',a,(function(){deleteValue(t),rebuildExistingSaves()}));var r=document.createElement('span');r.textContent='Delete',a.appendChild(r),n.appendChild(a);var u=document.createElement('li');u.className='nowrap';var d=document.createElement('a');d.href='data:application/octet-stream;base64,'+base64(generateBlob(t,findValue(t))),d.download=t+'_'+(new Date).getTime()+'.export',d.textContent='Download as import compatible',u.appendChild(d),n.appendChild(u);var s=document.createElement('li');s.className='nowrap';var l=document.createElement('a');l.href='data:application/octet-stream;base64,'+findValue(t),l.download=t+'_'+(new Date).getTime()+'.sav',l.textContent='Download as raw binary',s.appendChild(l),n.appendChild(s),i.appendChild(n),e.appendChild(i)}function decodeKeyType(e){return'SAVE_TYPE_GUID_'==e.substring(0,15)?'Game "'+e.substring(15)+'" Type Code':'SAVE_GUID_'==e.substring(0,10)?'Game "'+e.substring(10)+'" Cartridge Data':'SAVE_RTC_GUID_'==e.substring(0,15)?'Game "'+e.substring(15)+'" RTC Data':e}function removeChildNodes(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function didNotEnter(e,t){for(var i=void 0!==t.target?t.target:t.srcElement;i;){if(isSameNode(i,e))return!1;i=i.parentElement}return!0}function isSameNode(e,t){return'function'==typeof e.isSameNode?e.isSameNode(t):e===t}function addEvent(e,t,i){try{t.addEventListener(e,i,!1)}catch(o){t.attachEvent('on'+e,i)}}function removeEvent(e,t,i){try{t.removeEventListener(e,i,!1)}catch(o){t.detachEvent('on'+e,i)}}function keyDown(e){for(var t=0|e.keyCode,i=0;(0|i)<10;i=1+(0|i)|0)if((0|IodineGUI.defaults.keyZonesGBA[0|i])==(0|t))return IodineGUI.Iodine.keyDown(0|i),void(e.preventDefault&&e.preventDefault())}function keyUpGBA(e){e|=0;for(var t=0;(0|t)<10;t=1+(0|t)|0)if((0|IodineGUI.defaults.keyZonesGBA[0|t])==(0|e))return void IodineGUI.Iodine.keyUp(0|t)}function keyUp(e){e|=0;for(var t=0;(0|t)<8;t=1+(0|t)|0)if((0|IodineGUI.defaults.keyZonesControl[0|t])==(0|e))return keyboardEmulatorControl(0|t),!0;return!1}function keyUpPreprocess(e){var t=0|e.keyCode;IodineGUI.toMap?(IodineGUI.toMap[0|IodineGUI.toMapIndice]=0|t,IodineGUI.toMap=null,saveKeyBindings()):keyUp(0|t)||keyUpGBA(t)}function keyboardEmulatorControl(e){switch(0|(e|=0)){case 0:stepVolume(-.04);break;case 1:stepVolume(.04);break;case 2:IodineGUI.Iodine.incrementSpeed(.05);break;case 3:IodineGUI.Iodine.incrementSpeed(-.05);break;case 4:IodineGUI.Iodine.setSpeed(1);break;case 5:toggleFullScreen();break;case 6:togglePlayState();break;case 7:IodineGUI.Iodine.restart()}}function toggleFullScreen(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function togglePlayState(){IodineGUI.isPlaying?IodineGUI.Iodine.pause():IodineGUI.Iodine.play()}function attachBIOS(e){try{IodineGUI.Iodine.attachBIOS(new Uint8Array(e))}catch(t){IodineGUI.Iodine.attachBIOS(e)}}function attachROM(e){try{IodineGUI.Iodine.attachROM(new Uint8Array(e));setTimeout((()=>document.querySelector('#play').dispatchEvent(new MouseEvent('click',{}))),500)}catch(t){IodineGUI.Iodine.attachROM(e)}}function fileLoadShimCode(e,t){if(void 0!==e&&e.length>=1)try{var i=new FileReader;i.onloadend=function(){t(this.result)},i.readAsArrayBuffer(e[e.length-1])}catch(i){try{for(var o=e[e.length-1].getAsBinary(),n=[],a=0;a<o.length;++a)n[a]=255&o.charCodeAt(a);t(n)}catch(e){alert('Could not load the processed ROM file!')}}}function fileLoadBIOS(){fileLoadShimCode(this.files,attachBIOS)}function fileLoadROM(){fileLoadShimCode(this.files,attachROM)}function downloadFile(e,t){var i=new XMLHttpRequest;i.onload=t,i.open('GET',e,!0),i.responseType='arraybuffer',i.overrideMimeType('text/plain; charset=x-user-defined'),i.send(null)}function processDownload(e,t){try{t(new Uint8Array(e.response))}catch(r){for(var i=e.responseText,o=i.length,n=[],a=0;a<o;a++)n[a]=255&i.charCodeAt(a);t(n)}}function ImportSaveCallback(e,t,i){try{var o=findValue('SAVE_'+e);if(null!=o)return writeRedTemporaryText('Loaded save.'),void t(base64ToArray(o))}catch(e){writeRedTemporaryText('Could not read save: '+e.message)}i()}function ExportSave(){IodineGUI.Iodine.exportSave()}function ExportSaveCallback(e,t){if(''!=e)try{setValue('SAVE_'+e,arrayToBase64(t))}catch(e){writeRedTemporaryText('Could not store save: '+e.message)}}function registerSaveHandlers(){IodineGUI.Iodine.attachSaveExportHandler(ExportSaveCallback),IodineGUI.Iodine.attachSaveImportHandler(ImportSaveCallback)}function import_save(e){if((e=decodeBlob(e))&&e.blobs)if(e.blobs.length>0)for(var t=0;t<e.blobs.length;++t){var i=e.blobs[t].blobID,o=e.blobs[t].blobContent;writeRedTemporaryText('Importing blob "'+i+'"'),o?setValue(i,o):writeRedTemporaryText(i?'Save file imported had blob "'+i+'" with no blob data interpretable.':'Blob chunk information missing completely.')}else writeRedTemporaryText('Could not decode the imported file.');else writeRedTemporaryText('Could not decode the imported file.')}function generateBlob(e,t){var i='EMULATOR_DATA',o='GameBoyAdvance';return i+=to_little_endian_word(i.length+4+(1+o.length)+(1+e.length+(4+t.length))),i+=to_byte(o.length),i+=o,i+=to_byte(e.length),i+=e,i+=to_little_endian_word(t.length),i+=t}function generateMultiBlob(e){var t='GameBoyAdvance',i=18+t.length,o=to_byte(t.length);o+=t;for(var n='',a='',r=0;r<e.length;++r)n=e[r][0],a=e[r][1],o+=to_byte(n.length),o+=n,o+=to_little_endian_word(a.length),o+=a,i+=1+n.length+4+a.length;return o='EMULATOR_DATA'+to_little_endian_word(i)+o}function decodeBlob(e){var t=e.length,i={consoleID:null},o=-1;if(i.blobs=[],t>17&&'EMULATOR_DATA'==e.substring(0,13)){t=Math.min((255&e.charCodeAt(16))<<24|(255&e.charCodeAt(15))<<16|(255&e.charCodeAt(14))<<8|255&e.charCodeAt(13),t);var n=255&e.charCodeAt(17);if(t>17+n){i.consoleID=e.substring(18,18+n);for(var a=0,r=0,u=18+n;u<t;){if(a=255&e.charCodeAt(u++),!(u+a<t)){writeRedTemporaryText('Blob was incomplete, bailing out.');break}if(i.blobs[++o]={},i.blobs[o].blobID=e.substring(u,u+a),!((u+=a)+4<t)){writeRedTemporaryText('Blob was incomplete, bailing out.');break}if(r=(255&e.charCodeAt(u+3))<<24|(255&e.charCodeAt(u+2))<<16|(255&e.charCodeAt(u+1))<<8|255&e.charCodeAt(u),!((u+=4)+r<=t)){writeRedTemporaryText('Blob length check failed, blob determined to be incomplete.');break}i.blobs[o].blobContent=e.substring(u,u+r),u+=r}}}return i}function refreshStorageListing(){for(var e=getSavesKeys(),t=[],i=0;i<e.length;++i)t[i]=[e[i],findValue(e[i])];this.href='data:application/octet-stream;base64,'+base64(generateMultiBlob(t)),this.download='gameboy_advance_saves_'+(new Date).getTime()+'.export'}function checkStorageLength(){try{if(window.localStorage)return window.localStorage.length}catch(e){if(window.globalStorage&&location.hostname)return window.globalStorage[location.hostname].length}return 0}function getSavesKeys(){for(var e=checkStorageLength(),t=[],i=0,o=null;i<e&&null!==(o=findKey(i++))&&o.length>0;)'IodineGBA_SAVE_'==o.substring(0,15)&&t.push(o.substring(10));return t}function findKey(e){try{if(window.localStorage)return window.localStorage.key(e)}catch(t){if(window.globalStorage&&location.hostname)return window.globalStorage[location.hostname].key(e)}return null}function to_little_endian_word(e){return to_little_endian_hword(e)+to_little_endian_hword(e>>16)}function to_little_endian_hword(e){return to_byte(e)+to_byte(e>>8)}function to_byte(e){return String.fromCharCode(255&e)}function findValue(e){e='IodineGBA_'+e;try{if(window.localStorage&&null!=window.localStorage.getItem(e))return JSON.parse(window.localStorage.getItem(e))}catch(t){if(window.globalStorage&&location.hostname&&null!=window.globalStorage[location.hostname].getItem(e))return JSON.parse(window.globalStorage[location.hostname].getItem(e))}return null}function setValue(e,t){e='IodineGBA_'+e;try{window.localStorage&&window.localStorage.setItem(e,JSON.stringify(t))}catch(i){window.globalStorage&&location.hostname&&window.globalStorage[location.hostname].setItem(e,JSON.stringify(t))}}function deleteValue(e){e='IodineGBA_'+e;try{window.localStorage&&window.localStorage.removeItem(e)}catch(t){window.globalStorage&&location.hostname&&window.globalStorage[location.hostname].removeItem(e)}}window.onload=function(){registerDefaultSettings(),registerIodineHandler(),calculateTiming(),registerBlitterHandler(),registerAudioHandler(),registerSaveHandlers(),registerGUIEvents(),registerGUISettings(),downloadBIOS()},GfxGlueCode.prototype.initializeVSync=function(){window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var e=this;window.requestAnimationFrame?window.requestAnimationFrame((function(){e.vsync(),e.rAFKeepAlive()})):setInterval((function(){e.vsync()}),16)},GfxGlueCode.prototype.rAFKeepAlive=function(){var e=this;window.requestAnimationFrame((function(){e.vsync(),e.rAFKeepAlive()}))},GfxGlueCode.prototype.attachCanvas=function(e){this.canvas=e,this.graphicsFound=this.initializeCanvasTarget()},GfxGlueCode.prototype.detachCanvas=function(){this.canvas=null},GfxGlueCode.prototype.attachGfxCallback=function(e){'function'==typeof e&&(this.gfxCallback=e)},GfxGlueCode.prototype.attachGfxPostCallback=function(e){'function'==typeof e&&(this.gfxPostCallback=e)},GfxGlueCode.prototype.vsync=function(){this.graphicsFound&&('function'==typeof this.gfxCallback&&this.gfxCallback(),this.requestDraw())},GfxGlueCode.prototype.initializeBuffers=function(){this.swizzledFrameFree=[getUint8Array(this.offscreenRGBCount),getUint8Array(this.offscreenRGBCount)],this.swizzledFrameReady=[]},GfxGlueCode.prototype.recomputeDimension=function(){this.canvasLastWidth=this.canvas.clientWidth,this.canvasLastHeight=this.canvas.clientHeight,-1!=navigator.userAgent.toLowerCase().indexOf('gecko')&&-1==navigator.userAgent.toLowerCase().indexOf('like gecko')?(this.onscreenWidth=this.canvas.width=this.offscreenWidth,this.onscreenHeight=this.canvas.height=this.offscreenHeight):(this.onscreenWidth=this.canvas.width=this.canvas.clientWidth,this.onscreenHeight=this.canvas.height=this.canvas.clientHeight)},GfxGlueCode.prototype.initializeCanvasTarget=function(){try{return this.recomputeDimension(),this.canvasOffscreen=document.createElement('canvas'),this.canvasOffscreen.width=this.offscreenWidth,this.canvasOffscreen.height=this.offscreenHeight,this.drawContextOffscreen=this.canvasOffscreen.getContext('2d'),this.drawContextOnscreen=this.canvas.getContext('2d'),this.initializeCanvasBuffer(),!0}catch(e){return!1}},GfxGlueCode.prototype.initializeCanvasBuffer=function(){this.canvasBuffer=this.getBuffer(this.drawContextOffscreen,this.offscreenWidth,this.offscreenHeight),this.initializeAlpha(this.canvasBuffer.data)},GfxGlueCode.prototype.initializeAlpha=function(e){for(var t=e.length,i=3;i<t;i+=4)e[i]=255},GfxGlueCode.prototype.getBuffer=function(e,t,i){var o=null;try{o=this.drawContextOffscreen.createImageData(t,i)}catch(e){o=this.drawContextOffscreen.getImageData(0,0,t,i)}return o},__VIEWS_SUPPORTED__?GfxGlueCode.prototype.copyBuffer=function(e){if(this.graphicsFound){0==this.swizzledFrameFree.length&&this.swizzledFrameFree.push(this.swizzledFrameReady.shift());var t=this.swizzledFrameFree.shift();t.set(e),this.swizzledFrameReady.push(t)}}:GfxGlueCode.prototype.copyBuffer=function(e){if(this.graphicsFound){0==this.swizzledFrameFree.length&&this.swizzledFrameFree.push(this.swizzledFrameReady.shift());for(var t=this.swizzledFrameFree.shift(),i=0;i<this.offscreenRGBCount;i++)t[i]=e[i];this.swizzledFrameReady.push(t)}},GfxGlueCode.prototype.requestDraw=function(){if(this.swizzledFrameReady.length>0){for(var e=this.canvasBuffer.data,t=this.swizzledFrameReady.shift(),i=0,o=0;i<this.offscreenRGBACount;++i)e[i++]=t[o++],e[i++]=t[o++],e[i++]=t[o++];this.swizzledFrameFree.push(t),this.graphicsBlit(),'function'==typeof this.gfxPostCallback&&this.gfxPostCallback()}},GfxGlueCode.prototype.graphicsBlit=function(){this.canvasLastWidth==this.canvas.clientWidth&&this.canvasLastHeight==this.canvas.clientHeight||(this.recomputeDimension(),this.processSmoothing()),this.offscreenWidth==this.onscreenWidth&&this.offscreenHeight==this.onscreenHeight?this.drawContextOnscreen.putImageData(this.canvasBuffer,0,0):(this.drawContextOffscreen.putImageData(this.canvasBuffer,0,0),this.drawContextOnscreen.drawImage(this.canvasOffscreen,0,0,this.onscreenWidth,this.onscreenHeight))},GfxGlueCode.prototype.setSmoothScaling=function(e){this.doSmoothing=!!e,this.processSmoothing()},GfxGlueCode.prototype.processSmoothing=function(){this.graphicsFound&&(this.canvas.className=this.doSmoothing?'textureSmooth':'texturePixelated',this.drawContextOnscreen.mozImageSmoothingEnabled=this.doSmoothing,this.drawContextOnscreen.webkitImageSmoothingEnabled=this.doSmoothing,this.drawContextOnscreen.imageSmoothingEnabled=this.doSmoothing)};var gfxBuffers=null,gfxCounters=null;function IodineGBAWorkerGfxShim(){this.gfx=null,gfxBuffers=[getSharedUint8Array(115200),getSharedUint8Array(115200)],gfxCounters=getSharedInt32Array(3),this.Iodine=new GameBoyAdvanceEmulator}function IodineGBAWorkerShim(){this.playStatus=null,this.gfx=null,this.audio=null,this.speed=null,this.saveExport=null,this.saveImport=null,this.worker=null,this.gfxBuffers=null,this.gfxCounters=null,this.audioBuffer=null,this.audioCounters=null,this.audioSamplesRemaining=null,this.audioBufferSize=0,this.audioBufferSizeMask=0,this.audioInitialized=!1,this.timestamp=null,this.initialize()}IodineGBAWorkerGfxShim.prototype.play=function(){this.Iodine.play()},IodineGBAWorkerGfxShim.prototype.pause=function(){this.Iodine.pause()},IodineGBAWorkerGfxShim.prototype.restart=function(){this.Iodine.restart()},IodineGBAWorkerGfxShim.prototype.setIntervalRate=function(e){e=+e,this.Iodine.setIntervalRate(+e)},IodineGBAWorkerGfxShim.prototype.timerCallback=function(e){e>>>=0,this.Iodine.timerCallback(e)},IodineGBAWorkerGfxShim.prototype.attachGraphicsFrameHandler=function(e){this.gfx=e;var t=this;this.gfx.attachGfxCallback((function(){t.graphicsHeartBeat()})),this.Iodine.attachGraphicsFrameHandler(e)},IodineGBAWorkerGfxShim.prototype.attachAudioHandler=function(e){this.Iodine.attachAudioHandler(e)},IodineGBAWorkerGfxShim.prototype.enableAudio=function(){this.Iodine.enableAudio()},IodineGBAWorkerGfxShim.prototype.disableAudio=function(){this.Iodine.disableAudio()},IodineGBAWorkerGfxShim.prototype.toggleSkipBootROM=function(e){e|=0,this.Iodine.toggleSkipBootROM(0|e)},IodineGBAWorkerGfxShim.prototype.toggleDynamicSpeed=function(e){e|=0,this.Iodine.toggleDynamicSpeed(0|e)},IodineGBAWorkerGfxShim.prototype.toggleOffthreadGraphics=function(e){e|=0,this.Iodine.toggleOffthreadGraphics(0|e)},IodineGBAWorkerGfxShim.prototype.attachSpeedHandler=function(e){this.Iodine.attachSpeedHandler(e)},IodineGBAWorkerGfxShim.prototype.attachPlayStatusHandler=function(e){this.Iodine.attachPlayStatusHandler(e)},IodineGBAWorkerGfxShim.prototype.keyDown=function(e){e|=0,this.Iodine.keyDown(0|e)},IodineGBAWorkerGfxShim.prototype.keyUp=function(e){e|=0,this.Iodine.keyUp(0|e)},IodineGBAWorkerGfxShim.prototype.incrementSpeed=function(e){e=+e,this.Iodine.incrementSpeed(+e)},IodineGBAWorkerGfxShim.prototype.setSpeed=function(e){e=+e,this.Iodine.setSpeed(+e)},IodineGBAWorkerGfxShim.prototype.attachBIOS=function(e){this.Iodine.attachBIOS(e)},IodineGBAWorkerGfxShim.prototype.attachROM=function(e){this.Iodine.attachROM(e)},IodineGBAWorkerGfxShim.prototype.exportSave=function(){this.Iodine.exportSave()},IodineGBAWorkerGfxShim.prototype.attachSaveExportHandler=function(e){this.Iodine.attachSaveExportHandler(e)},IodineGBAWorkerGfxShim.prototype.attachSaveImportHandler=function(e){this.Iodine.attachSaveImportHandler(e)},IodineGBAWorkerGfxShim.prototype.graphicsHeartBeat=function(){this.gfx&&gfxCounters&&(this.consumeGraphicsBuffer(),Atomics.notify(gfxCounters,2,1))},IodineGBAWorkerGfxShim.prototype.consumeGraphicsBuffer=function(){var e=0|gfxCounters[0],t=0|Atomics.load(gfxCounters,1);if((0|t)!=(0|e)){do{this.gfx.copyBuffer(gfxBuffers[1&e]),e=1+(0|e)|0}while((0|e)!=(0|t));gfxCounters[0]=0|t}};var tempvar=document.getElementsByTagName('script');function Resampler(e,t,i,o){if(this.fromSampleRate=+e,this.toSampleRate=+t,this.channels=0|i,'object'!=typeof o)throw new Error('inputBuffer is not an object.');if(!(o instanceof Array||o instanceof Float32Array||o instanceof Float64Array))throw new Error('inputBuffer is not an array or a float32 or a float64 array.');this.inputBuffer=o,this.initialize()}IodineGBAWorkerShim.prototype.filepath=tempvar[tempvar.length-1].src,IodineGBAWorkerShim.prototype.initialize=function(){var e=this;this.worker=new Worker(new URL('./IodineGBA/core/Worker.js',location)),this.worker.onmessage=function(t){e.decodeMessage(t.data)}},IodineGBAWorkerShim.prototype.sendMessageSingle=function(e){e|=0,this.worker.postMessage({messageID:e})},IodineGBAWorkerShim.prototype.sendMessageDouble=function(e,t){e|=0,this.worker.postMessage({messageID:e,payload:t})},IodineGBAWorkerShim.prototype.play=function(){this.sendMessageSingle(0)},IodineGBAWorkerShim.prototype.pause=function(){this.sendMessageSingle(1)},IodineGBAWorkerShim.prototype.restart=function(){this.sendMessageSingle(2)},IodineGBAWorkerShim.prototype.setIntervalRate=function(e){e=+e,this.sendMessageDouble(3,+e)},IodineGBAWorkerShim.prototype.timerCallback=function(e){e>>>=0,this.timestamp&&Atomics.store(this.timestamp,0,e>>>0)},IodineGBAWorkerShim.prototype.attachPlayStatusHandler=function(e){this.playStatus=e,this.sendMessageSingle(23)},IodineGBAWorkerShim.prototype.issuePlayStatus=function(e){e|=0,this.playStatus&&this.playStatus(0|e)},IodineGBAWorkerShim.prototype.attachGraphicsFrameHandler=function(e){this.gfx=e;var t=this;this.gfx.attachGfxCallback((function(){t.graphicsHeartBeat()})),this.sendMessageSingle(4)},IodineGBAWorkerShim.prototype.attachAudioHandler=function(e){this.audio=e,this.sendMessageSingle(5)},IodineGBAWorkerShim.prototype.enableAudio=function(){this.audio&&this.sendMessageSingle(6)},IodineGBAWorkerShim.prototype.disableAudio=function(){this.audio&&this.sendMessageSingle(7)},IodineGBAWorkerShim.prototype.toggleSkipBootROM=function(e){e|=0,this.sendMessageDouble(8,0|e)},IodineGBAWorkerShim.prototype.toggleDynamicSpeed=function(e){e|=0,this.sendMessageDouble(9,0|e)},IodineGBAWorkerShim.prototype.toggleOffthreadGraphics=function(e){e|=0,this.sendMessageDouble(22,0|e)},IodineGBAWorkerShim.prototype.attachSpeedHandler=function(e){this.speed=e,this.sendMessageSingle(10)},IodineGBAWorkerShim.prototype.keyDown=function(e){e|=0,this.sendMessageDouble(11,0|e)},IodineGBAWorkerShim.prototype.keyUp=function(e){e|=0,this.sendMessageDouble(12,0|e)},IodineGBAWorkerShim.prototype.incrementSpeed=function(e){e=+e,this.sendMessageDouble(13,+e)},IodineGBAWorkerShim.prototype.setSpeed=function(e){e=+e,this.sendMessageDouble(14,+e)},IodineGBAWorkerShim.prototype.attachBIOS=function(e){this.sendMessageDouble(15,e)},IodineGBAWorkerShim.prototype.attachROM=function(e){this.sendMessageDouble(16,e)},IodineGBAWorkerShim.prototype.exportSave=function(){this.sendMessageSingle(17)},IodineGBAWorkerShim.prototype.attachSaveExportHandler=function(e){this.saveExport=e,this.sendMessageSingle(18)},IodineGBAWorkerShim.prototype.attachSaveImportHandler=function(e){this.saveImport=e,this.sendMessageSingle(19)},IodineGBAWorkerShim.prototype.decodeMessage=function(e){switch(0|e.messageID){case 0:this.buffersInitialize(e.gfxBuffer1,e.gfxBuffer2,e.gfxCounters,e.audioSamplesRemaining,e.timestamp);break;case 1:this.audioInitialize(0|e.channels,+e.sampleRate,0|e.bufferLimit,e.audioBuffer,e.audioCounters);break;case 2:this.audioRegister();break;case 3:this.audioUnregister();break;case 4:this.audioSetBufferSpace(0|e.audioBufferContainAmount);break;case 5:this.saveImportRequest(e.saveID);break;case 6:this.saveExportRequest(e.saveID,e.saveData);break;case 7:this.speedPush(+e.speed);break;default:this.issuePlayStatus(0|e.playing)}},IodineGBAWorkerShim.prototype.audioInitialize=function(e,t,i,o,n){e|=0,t=+t,i|=0;var a=this;this.audio&&(this.audio.initialize(0|e,+t,0|i,(function(){a.audioHeartBeat()}),(function(){a.audioPostHeartBeat()}),(function(){a.disableAudio()})),this.audioInitialized=!0),this.audioBuffer=o,this.audioCounters=n,this.audioBufferSize=0|o.length,this.audioBufferSizeMask=(0|this.audioBufferSize)-1|0},IodineGBAWorkerShim.prototype.audioHeartBeat=function(){this.audioInitialized&&this.consumeAudioBuffer()},IodineGBAWorkerShim.prototype.consumeAudioBuffer=function(){var e=0|this.audioCounters[0],t=0|Atomics.load(this.audioCounters,1);(0|t)!=(0|e)&&(this.copyAudioBuffer(0|e,0|t),this.audioPostHeartBeat(),Atomics.store(this.audioCounters,0,0|t),this.audio.flush())},IodineGBAWorkerShim.prototype.copyAudioBuffer=function(e,t){t|=0;var i=(0|(e|=0))&(0|this.audioBufferSizeMask)|0,o=(0|t)&(0|this.audioBufferSizeMask)|0;(0|i)>=(0|o)?(this.audio.pushDeferred(this.audioBuffer,0|i,0|this.audioBufferSize),this.audio.pushDeferred(this.audioBuffer,0,0|o)):this.audio.pushDeferred(this.audioBuffer,0|i,0|o)},IodineGBAWorkerShim.prototype.audioPostHeartBeat=function(){this.audioSamplesRemaining[0]=0|this.audio.remainingBuffer()},IodineGBAWorkerShim.prototype.graphicsHeartBeat=function(){this.gfx&&this.gfxCounters&&(this.consumeGraphicsBuffer(),Atomics.notify(this.gfxCounters,2,1))},IodineGBAWorkerShim.prototype.consumeGraphicsBuffer=function(){var e=0|this.gfxCounters[0],t=0|Atomics.load(this.gfxCounters,1);if((0|t)!=(0|e)){do{this.gfx.copyBuffer(this.gfxBuffers[1&e]),e=1+(0|e)|0}while((0|e)!=(0|t));this.gfxCounters[0]=0|t}},IodineGBAWorkerShim.prototype.audioRegister=function(){this.audio&&this.audio.register()},IodineGBAWorkerShim.prototype.audioUnregister=function(){this.audio&&(this.audioHeartBeat(),this.audio.unregister())},IodineGBAWorkerShim.prototype.audioSetBufferSpace=function(e){e|=0,this.audio&&this.audio.setBufferSpace(0|e)},IodineGBAWorkerShim.prototype.buffersInitialize=function(e,t,i,o,n){this.gfxBuffers=[e,t],this.gfxCounters=i,this.audioSamplesRemaining=o,this.timestamp=n},IodineGBAWorkerShim.prototype.speedPush=function(e){e=+e,this.speed&&this.speed(+e)},IodineGBAWorkerShim.prototype.saveImportRequest=function(e){if(this.saveImport){var t=this;this.saveImport(e,(function(e){t.sendMessageDouble(20,e)}),(function(){t.sendMessageSingle(21)}))}},IodineGBAWorkerShim.prototype.saveExportRequest=function(e,t){this.saveExport&&this.saveExport(e,t)},Resampler.prototype.initialize=function(){if(!(this.fromSampleRate>0&&this.toSampleRate>0&&this.channels>0))throw new Error('Invalid settings specified for the resampler.');this.fromSampleRate==this.toSampleRate?(this.resampler=this.bypassResampler,this.ratioWeight=1,this.outputBuffer=this.inputBuffer):(this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0),this.initializeBuffers())},Resampler.prototype.compileLinearInterpolationFunction=function(){for(var e='var outputOffset = 0;    if (bufferLength > 0) {        var buffer = this.inputBuffer;        var weight = this.lastWeight;        var firstWeight = 0;        var secondWeight = 0;        var sourceOffset = 0;        var outputOffset = 0;        var outputBuffer = this.outputBuffer;        for (; weight < 1; weight += '+this.ratioWeight+') {            secondWeight = weight % 1;            firstWeight = 1 - secondWeight;',t=0;t<this.channels;++t)e+='outputBuffer[outputOffset++] = (this.lastOutput['+t+'] * firstWeight) + (buffer['+t+'] * secondWeight);';e+='}        weight -= 1;        for (bufferLength -= '+this.channels+', sourceOffset = Math.floor(weight) * '+this.channels+'; sourceOffset < bufferLength;) {            secondWeight = weight % 1;            firstWeight = 1 - secondWeight;';for(t=0;t<this.channels;++t)e+='outputBuffer[outputOffset++] = (buffer[sourceOffset'+(t>0?' + '+t:'')+'] * firstWeight) + (buffer[sourceOffset + '+(this.channels+t)+'] * secondWeight);';e+='weight += '+this.ratioWeight+';            sourceOffset = Math.floor(weight) * '+this.channels+';        }';for(t=0;t<this.channels;++t)e+='this.lastOutput['+t+'] = buffer[sourceOffset++];';e+='this.lastWeight = weight % 1;    }    return outputOffset;',this.resampler=Function('bufferLength',e)},Resampler.prototype.compileMultiTapFunction=function(){for(var e='var outputOffset = 0;    if (bufferLength > 0) {        var buffer = this.inputBuffer;        var weight = 0;',t=0;t<this.channels;++t)e+='var output'+t+' = 0;';for(e+='var actualPosition = 0;        var amountToNext = 0;        var alreadyProcessedTail = !this.tailExists;        this.tailExists = false;        var outputBuffer = this.outputBuffer;        var currentPosition = 0;        do {            if (alreadyProcessedTail) {                weight = '+this.ratioWeight+';',t=0;t<this.channels;++t)e+='output'+t+' = 0;';for(e+='}            else {                weight = this.lastWeight;',t=0;t<this.channels;++t)e+='output'+t+' = this.lastOutput['+t+'];';for(e+='alreadyProcessedTail = true;            }            while (weight > 0 && actualPosition < bufferLength) {                amountToNext = 1 + actualPosition - currentPosition;                if (weight >= amountToNext) {',t=0;t<this.channels;++t)e+='output'+t+' += buffer[actualPosition++] * amountToNext;';for(e+='currentPosition = actualPosition;                    weight -= amountToNext;                }                else {',t=0;t<this.channels;++t)e+='output'+t+' += buffer[actualPosition'+(t>0?' + '+t:'')+'] * weight;';for(e+='currentPosition += weight;                    weight = 0;                    break;                }            }            if (weight <= 0) {',t=0;t<this.channels;++t)e+='outputBuffer[outputOffset++] = output'+t+' / '+this.ratioWeight+';';for(e+='}            else {                this.lastWeight = weight;',t=0;t<this.channels;++t)e+='this.lastOutput['+t+'] = output'+t+';';e+='this.tailExists = true;                break;            }        } while (actualPosition < bufferLength);    }    return outputOffset;',this.resampler=Function('bufferLength',e)},Resampler.prototype.bypassResampler=function(e){return e},Resampler.prototype.initializeBuffers=function(){var e=Math.ceil(this.inputBuffer.length*this.toSampleRate/this.fromSampleRate/this.channels*1.0000004768371582)*this.channels+this.channels;try{this.outputBuffer=new Float32Array(e),this.lastOutput=new Float32Array(this.channels)}catch(e){this.outputBuffer=[],this.lastOutput=[]}};var XAudioJSscriptsHandle=document.getElementsByTagName('script'),XAudioJSsourceHandle=XAudioJSscriptsHandle[XAudioJSscriptsHandle.length-1].src;function XAudioServer(e,t,i,o,n,a,r,u,d,s){XAudioJSChannelsAllocated=Math.max(e,1),this.XAudioJSSampleRate=Math.abs(t),XAudioJSMinBufferSize=i>=XAudioJSSamplesPerCallback*XAudioJSChannelsAllocated&&i<o?i&-XAudioJSChannelsAllocated:XAudioJSSamplesPerCallback*XAudioJSChannelsAllocated,XAudioJSMaxBufferSize=Math.floor(o)>XAudioJSMinBufferSize+XAudioJSChannelsAllocated?o&-XAudioJSChannelsAllocated:XAudioJSMinBufferSize*XAudioJSChannelsAllocated,this.underRunCallback='function'==typeof n?n:function(){},XAudioJSCallbackAPIEventNotificationCallback='function'==typeof a?a:null,XAudioJSCallbackAPIEventNotificationCallback2='function'==typeof r?r:null,XAudioJSVolume=u>=0&&u<=1?u:1,this.failureCallback='function'==typeof d?d:function(){throw new Error('XAudioJS has encountered a fatal error.')},this.userEventLatch='object'==typeof s?s:null,this.initializeAudio()}function XAudioJSFlashAudioEvent(){XAudioJSCallbackAPIEventNotificationCallbackCompatTimerClear(),XAudioJSCallbackAPIEventNotification(),XAudioJSResampleRefill();var e=XAudioJSFlashTransportEncoder();return XAudioJSCallbackAPIEventNotification2(),e}function XAudioJSGenerateFlashSurroundString(){var e=XAudioJSSamplesPerCallback<<1;XAudioJSBinaryString.length>e&&(XAudioJSBinaryString=[]),e=0;for(var t=0;t<XAudioJSSamplesPerCallback&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;++t)XAudioJSBinaryString[e++]=String.fromCharCode(12288+(16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)),XAudioJSBinaryString[e++]=String.fromCharCode(12288+(16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)),(XAudioJSResampleBufferStart+=XAudioJSChannelsAllocated-2)==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);return XAudioJSBinaryString.join('')}function XAudioJSGenerateFlashStereoString(){var e=XAudioJSSamplesPerCallback<<1;XAudioJSBinaryString.length>e&&(XAudioJSBinaryString=[]);for(var t=0;t<e&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;)XAudioJSBinaryString[t++]=String.fromCharCode(12288+(16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)),XAudioJSBinaryString[t++]=String.fromCharCode(12288+(16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)),XAudioJSResampleBufferStart==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);return XAudioJSBinaryString.join('')}function XAudioJSGenerateFlashMonoString(){XAudioJSBinaryString.length>XAudioJSSamplesPerCallback&&(XAudioJSBinaryString=[]);for(var e=0;e<XAudioJSSamplesPerCallback&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;)XAudioJSBinaryString[e++]=String.fromCharCode(12288+(16383*Math.min(Math.max(XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]+1,0),2)|0)),XAudioJSResampleBufferStart==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);return XAudioJSBinaryString.join('')}XAudioServer.prototype.MOZWriteAudioNoCallback=function(e,t){for(var i=Math.min(e.length,t),o=0;o<i;){for(var n=Math.min(i-o,XAudioJSMaxBufferSize),a=0;a<n;++a)XAudioJSAudioContextSampleBuffer[a]=e[o++];var r=XAudioJSResampleControl.resampler(a);if(r>0){var u=XAudioJSGetArraySlice(XAudioJSResampleControl.outputBuffer,r);this.samplesAlreadyWritten+=this.audioHandleMoz.mozWriteAudio(u)}}},XAudioServer.prototype.callbackBasedWriteAudioNoCallback=function(e,t){for(var i=Math.min(e.length,t),o=0;o<i&&XAudioJSAudioBufferSize<XAudioJSMaxBufferSize;)XAudioJSAudioContextSampleBuffer[XAudioJSAudioBufferSize++]=e[o++]},XAudioServer.prototype.writeAudio=function(e,t){switch(this.audioType){case 0:this.MOZWriteAudioNoCallback(e,t),this.MOZExecuteCallback();break;case 2:this.checkFlashInit();case 1:this.callbackBasedWriteAudioNoCallback(e,t),this.callbackBasedExecuteCallback();break;default:this.failureCallback()}},XAudioServer.prototype.writeAudioNoCallback=function(e,t){switch(this.audioType){case 0:this.MOZWriteAudioNoCallback(e,t);break;case 2:this.checkFlashInit();case 1:this.callbackBasedWriteAudioNoCallback(e,t);break;default:this.failureCallback()}},XAudioServer.prototype.remainingBuffer=function(){switch(this.audioType){case 0:return Math.floor((this.samplesAlreadyWritten-this.audioHandleMoz.mozCurrentSampleOffset())*XAudioJSResampleControl.ratioWeight/XAudioJSChannelsAllocated)*XAudioJSChannelsAllocated;case 2:this.checkFlashInit();case 1:return Math.floor(XAudioJSResampledSamplesLeft()*XAudioJSResampleControl.ratioWeight/XAudioJSChannelsAllocated)*XAudioJSChannelsAllocated+XAudioJSAudioBufferSize;default:return this.failureCallback(),null}},XAudioServer.prototype.MOZExecuteCallback=function(){var e=XAudioJSMinBufferSize-this.remainingBuffer();if(e>0){var t=this.underRunCallback(e);this.MOZWriteAudioNoCallback(t,t.length)}},XAudioServer.prototype.callbackBasedExecuteCallback=function(){var e=XAudioJSMinBufferSize-this.remainingBuffer();if(e>0){var t=this.underRunCallback(e);this.callbackBasedWriteAudioNoCallback(t,t.length)}},XAudioServer.prototype.executeCallback=function(){switch(this.audioType){case 0:this.MOZExecuteCallback();break;case 2:this.checkFlashInit();case 1:this.callbackBasedExecuteCallback();break;default:this.failureCallback()}},XAudioServer.prototype.initializeAudio=function(){try{this.initializeMozAudio()}catch(e){try{this.initializeWebAudio()}catch(e){try{this.initializeFlashAudio()}catch(e){this.audioType=-1,this.failureCallback()}}}},XAudioServer.prototype.initializeMozAudio=function(){this.audioHandleMoz=new Audio,this.audioHandleMoz.mozSetup(XAudioJSChannelsAllocated,XAudioJSMozAudioSampleRate),this.audioHandleMoz.volume=XAudioJSVolume,this.samplesAlreadyWritten=0,this.audioType=0;var e=this.XAudioJSSampleRate*XAudioJSChannelsAllocated/10|0;e-=e%XAudioJSChannelsAllocated,this.samplesAlreadyWritten-=e,this.initializeResampler(XAudioJSMozAudioSampleRate)},XAudioServer.prototype.initializeWebAudio=function(){if('undefined'==typeof AudioContext||void 0===XAudioJSWebAudioContextHandle)throw null;if(this.userEventLatch){var e=this,t=0;this.userEventLatch.addEventListener('click',(function(){0==t&&(e.setupWebAudio(),t|=1)}),!1),this.userEventLatch.addEventListener('touchstart',(function(){t<2&&(e.setupWebAudio(),t|=2)}),!1),this.userEventLatch.addEventListener('touchend',(function(){t<4&&(e.setupWebAudio(),t|=4)}),!1),this.resetCallbackAPIAudioBuffer(44100)}else this.setupWebAudio();this.audioType=1},XAudioServer.prototype.setupWebAudio=function(){XAudioJSWebAudioLaunchedContext&&XAudioJSWebAudioContextHandle.close();try{XAudioJSWebAudioContextHandle=new AudioContext}catch(e){XAudioJSWebAudioContextHandle=new webkitAudioContext}XAudioJSWebAudioLaunchedContext=!0,XAudioJSWebAudioAudioNode&&(XAudioJSWebAudioAudioNode.disconnect(),XAudioJSWebAudioAudioNode.onaudioprocess=null,XAudioJSWebAudioAudioNode=null);try{XAudioJSWebAudioAudioNode=XAudioJSWebAudioContextHandle.createScriptProcessor(XAudioJSSamplesPerCallback,0,XAudioJSChannelsAllocated)}catch(e){XAudioJSWebAudioAudioNode=XAudioJSWebAudioContextHandle.createJavaScriptNode(XAudioJSSamplesPerCallback,0,XAudioJSChannelsAllocated)}if(XAudioJSWebAudioAudioNode.onaudioprocess=XAudioJSWebAudioEvent,XAudioJSWebAudioAudioNode.connect(XAudioJSWebAudioContextHandle.destination),this.resetCallbackAPIAudioBuffer(XAudioJSWebAudioContextHandle.sampleRate),XAudioJSWebAudioWatchDogLast=(new Date).getTime(),!XAudioJSWebAudioWatchDogTimer&&navigator.userAgent.indexOf('Gecko/')>-1){XAudioJSWebAudioWatchDogTimer&&clearInterval(XAudioJSWebAudioWatchDogTimer);var e=this;XAudioJSWebAudioWatchDogTimer=setInterval((function(){if(void 0!==XAudioJSWebAudioContextHandle.state)if('suspended'===XAudioJSWebAudioContextHandle.state){XAudioJSWebAudioWatchDogLast=(new Date).getTime();try{XAudioJSWebAudioContextHandle.resume()}catch(e){}}else{(new Date).getTime()-XAudioJSWebAudioWatchDogLast>500&&e.setupWebAudio()}}),500)}},XAudioServer.prototype.initializeFlashAudio=function(){var e=document.getElementById('XAudioJS');switch(this.flashInitialized=!1,this.resetCallbackAPIAudioBuffer(44100),XAudioJSChannelsAllocated){case 1:XAudioJSFlashTransportEncoder=XAudioJSGenerateFlashMonoString;break;case 2:XAudioJSFlashTransportEncoder=XAudioJSGenerateFlashStereoString;break;default:XAudioJSFlashTransportEncoder=XAudioJSGenerateFlashSurroundString}if(null==e){this.audioHandleFlash=null;var t=document.createElement('div');t.setAttribute('style','position: fixed; bottom: 0px; right: 0px; margin: 0px; padding: 0px; border: none; width: 8px; height: 8px; overflow: hidden; z-index: -1000; ');var i=document.createElement('div');i.setAttribute('style','position: static; border: none; width: 0px; height: 0px; visibility: hidden; margin: 8px; padding: 0px;'),i.setAttribute('id','XAudioJS'),t.appendChild(i),document.getElementsByTagName('body')[0].appendChild(t)}else this.audioHandleFlash=e,this.checkFlashInit();this.audioType=2},XAudioServer.prototype.changeVolume=function(e){if(e>=0&&e<=1)switch(XAudioJSVolume=e,this.audioType){case 0:this.audioHandleMoz.volume=XAudioJSVolume;case 1:break;case 2:this.flashInitialized?this.audioHandleFlash.changeVolume(XAudioJSVolume):this.checkFlashInit();break;default:this.failureCallback()}},XAudioServer.prototype.checkFlashInit=function(){if(!this.flashInitialized)try{this.audioHandleFlash&&this.audioHandleFlash.initialize&&(this.flashInitialized=!0,this.audioHandleFlash.initialize(XAudioJSChannelsAllocated,XAudioJSVolume))}catch(e){this.flashInitialized=!1}},XAudioServer.prototype.resetCallbackAPIAudioBuffer=function(e){XAudioJSAudioBufferSize=XAudioJSResampleBufferEnd=XAudioJSResampleBufferStart=0,this.initializeResampler(e),XAudioJSResampledBuffer=this.getFloat32(XAudioJSResampleBufferSize)},XAudioServer.prototype.initializeResampler=function(e){XAudioJSAudioContextSampleBuffer=this.getFloat32(XAudioJSMaxBufferSize),XAudioJSResampleControl=new Resampler(this.XAudioJSSampleRate,e,XAudioJSChannelsAllocated,XAudioJSAudioContextSampleBuffer),XAudioJSResampleBufferSize=XAudioJSResampleControl.outputBuffer.length},XAudioServer.prototype.getFloat32=function(e){try{return new Float32Array(e)}catch(e){return[]}};var XAudioJSWebAudioContextHandle=null,XAudioJSWebAudioAudioNode=null,XAudioJSWebAudioWatchDogTimer=null,XAudioJSCallbackAPIEventNotificationCallback=null,XAudioJSCallbackAPIEventNotificationCallback2=null,XAudioJSCallbackAPIEventNotificationCallbackCompatTimer=setInterval(XAudioJSCallbackAPIEventNotificationDual,16),XAudioJSWebAudioWatchDogLast=!1,XAudioJSWebAudioLaunchedContext=!1,XAudioJSAudioContextSampleBuffer=[],XAudioJSResampledBuffer=[],XAudioJSMinBufferSize=15e3,XAudioJSMaxBufferSize=25e3,XAudioJSChannelsAllocated=1,XAudioJSVolume=1,XAudioJSResampleControl=null,XAudioJSAudioBufferSize=0,XAudioJSResampleBufferStart=0,XAudioJSResampleBufferEnd=0,XAudioJSResampleBufferSize=0,XAudioJSMozAudioSampleRate=44100,XAudioJSSamplesPerCallback=2048,XAudioJSFlashTransportEncoder=null,XAudioJSBinaryString=[];function XAudioJSWebAudioEvent(e){XAudioJSWebAudioWatchDogTimer&&(XAudioJSWebAudioWatchDogLast=(new Date).getTime());for(var t=0,i=[];t<XAudioJSChannelsAllocated;++t)i[t]=e.outputBuffer.getChannelData(t);XAudioJSCallbackAPIEventNotificationCallbackCompatTimerClear(),XAudioJSCallbackAPIEventNotification(),XAudioJSResampleRefill();for(var o=0;o<XAudioJSSamplesPerCallback&&XAudioJSResampleBufferStart!=XAudioJSResampleBufferEnd;++o){for(t=0;t<XAudioJSChannelsAllocated;++t)i[t][o]=XAudioJSResampledBuffer[XAudioJSResampleBufferStart++]*XAudioJSVolume;XAudioJSResampleBufferStart==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0)}for(;o<XAudioJSSamplesPerCallback;){for(t=0;t<XAudioJSChannelsAllocated;++t)i[t][o]=0;++o}XAudioJSCallbackAPIEventNotification2()}function XAudioJSResampleRefill(){if(XAudioJSAudioBufferSize>0){for(var e=XAudioJSResampleControl.resampler(XAudioJSAudioBufferSize),t=XAudioJSResampleControl.outputBuffer,i=0;i<e;)XAudioJSResampledBuffer[XAudioJSResampleBufferEnd++]=t[i++],XAudioJSResampleBufferEnd==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferEnd=0),XAudioJSResampleBufferStart==XAudioJSResampleBufferEnd&&(XAudioJSResampleBufferStart+=XAudioJSChannelsAllocated)==XAudioJSResampleBufferSize&&(XAudioJSResampleBufferStart=0);XAudioJSAudioBufferSize=0}}function XAudioJSCallbackAPIEventNotificationCallbackCompatTimerClear(){XAudioJSCallbackAPIEventNotificationCallbackCompatTimer&&clearInterval(XAudioJSCallbackAPIEventNotificationCallbackCompatTimer)}function XAudioJSCallbackAPIEventNotification(){'function'==typeof XAudioJSCallbackAPIEventNotificationCallback&&XAudioJSCallbackAPIEventNotificationCallback()}function XAudioJSCallbackAPIEventNotification2(){'function'==typeof XAudioJSCallbackAPIEventNotificationCallback2&&XAudioJSCallbackAPIEventNotificationCallback2()}function XAudioJSCallbackAPIEventNotificationDual(){XAudioJSCallbackAPIEventNotification(),XAudioJSCallbackAPIEventNotification2()}function XAudioJSResampledSamplesLeft(){return(XAudioJSResampleBufferStart<=XAudioJSResampleBufferEnd?0:XAudioJSResampleBufferSize)+XAudioJSResampleBufferEnd-XAudioJSResampleBufferStart}function XAudioJSGetArraySlice(e,t){try{return e.subarray(0,t)}catch(i){try{return e.length=t,e}catch(i){return e.slice(0,t)}}}